<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hzfh.rest_p2p.order.mapper.CouponPaymentPlanMapper">
	<resultMap type="com.hzfh.api.p2pOrder.model.CouponPaymentPlan" id="resultMapCouponPaymentPlan">
		<result property="id" column="id"/>
		<result property="salesNo" column="sales_no"/>
		<result property="awardNo" column="award_no"/>
		<result property="customerNo" column="customer_no"/>
		<result property="customerName" column="customer_name"/>
		<result property="transactionAmount" column="transaction_amount"/>
		<result property="interest" column="interest"/>
		<result property="acturalInterest" column="actural_interest"/>
		<result property="paymentAmount" column="payment_amount"/>
		<result property="actualPaymentAmount" column="actual_payment_amount"/>
		<result property="paymentTime" column="payment_time" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp"/>
		<result property="actualPaymentTime" column="actual_payment_time" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp"/>
		<result property="productPaymentNo" column="product_payment_no"/>
		<result property="status" column="status"/>
		<result property="createDate" column="create_date" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp"/>
		<result property="sn" column="sn"/>
	</resultMap>
	<select id="getList" resultMap="resultMapCouponPaymentPlan">
		SELECT id,sales_no,award_no,customer_no,customer_name,transaction_amount,interest,actural_interest,payment_amount,actual_payment_amount,payment_time,actual_payment_time,product_payment_no,status,create_date,sn
		FROM coupon_payment_plan
	</select>

	<select id="getTotalCount" resultType="long" parameterType="com.hzfh.api.p2pOrder.model.query.CouponPaymentPlanCondition" statementType="STATEMENT">
		SELECT count(1) FROM coupon_payment_plan where 1=1
	</select>
	<select id="getInfo" resultMap="resultMapCouponPaymentPlan" parameterType="int">
		SELECT id,sales_no,award_no,customer_no,customer_name,transaction_amount,interest,actural_interest,payment_amount,actual_payment_amount,payment_time,actual_payment_time,product_payment_no,status,create_date,sn FROM coupon_payment_plan where id=#{id}
	</select>

	<update id="update" parameterType="com.hzfh.api.p2pOrder.model.CouponPaymentPlan">
		update coupon_payment_plan set 
		sales_no=#{salesNo},award_no=#{awardNo},customer_no=#{customerNo},customer_name=#{customerName},transaction_amount=#{transactionAmount},interest=#{interest},actural_interest=#{acturalInterest},payment_amount=#{paymentAmount},actual_payment_amount=#{actualPaymentAmount},payment_time=#{paymentTime},actual_payment_time=#{actualPaymentTime},product_payment_no=#{productPaymentNo},status=#{status},create_date=#{createDate},sn=#{sn}
		where id=#{id}
	</update>

	<select id="getCouponPaymentRefund" resultMap="resultMapCouponPaymentPlan">
		SELECT sum(pr.actual_payment_amount) AS actual_payment_amount,pr.actural_interest AS actural_interest
		FROM coupon_payment_plan pr
		LEFT JOIN product_payment_plan pp ON pp.id = pr.product_payment_no
		where pr.customer_no=#{customerNo} and pr.sales_no=#{salesNo}
		GROUP BY actual_pay_time
		ORDER BY actual_pay_time asc
	</select>
	
	<select id="getListByProductPaymentNo" resultMap="resultMapCouponPaymentPlan">
		SELECT id,sales_no,award_no,customer_no,customer_name,transaction_amount,interest,actural_interest,payment_amount,actual_payment_amount,payment_time,actual_payment_time,product_payment_no,status,create_date,sn
		FROM coupon_payment_plan where product_payment_no = #{productPaymentNo}
	</select>
	
	<update id="updateSnByProductPaymentNo" >
		update coupon_payment_plan set 
		sn=#{sn}
		where product_payment_no=#{productPaymentNo}
	</update>
	
	<update id="updateStatusById">
		update coupon_payment_plan set 
		status=#{status}
		where id=#{id}
	</update>
	<select id="getListByProductNo" resultMap="resultMapCouponPaymentPlan" parameterType="int">
		SELECT t.id, t.sales_no, t.award_no, t.customer_no, t.customer_name, t.transaction_amount, t.interest, 
		t.actural_interest, t.payment_amount, t.actual_payment_amount, t.payment_time, t.actual_payment_time, 
		t.product_payment_no, t. STATUS, t.create_date, t.sn 
		FROM coupon_payment_plan t, sales t1 
		WHERE t.sales_no = t1.id AND t1.product_no = #{productNo}
	</select>
	
</mapper>